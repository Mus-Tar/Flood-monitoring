# 洪水监测系统 - 修复后测试指南

## 🚀 启动服务

### 1. 执行数据库修复脚本
```sql
-- 在MySQL中执行以下SQL（或使用 fix_user_data.sql 文件）
UPDATE sys_user SET password = '123456' WHERE username = 'mustar';
SELECT id, username, password, role, created_at FROM sys_user;
```

### 2. 启动后端服务
```powershell
cd "c:\Users\MuStar\Desktop\Flood monitoring\backend"
mvn spring-boot:run
```
**预期结果：** 后端在 http://localhost:8080 启动成功

### 3. 启动前端服务
```powershell
cd "c:\Users\MuStar\Desktop\Flood monitoring\frontend"
npm run dev
```
**预期结果：** 前端在 http://localhost:3000 或 5173 启动成功

## 📋 功能测试清单

### ✅ 测试1：现有用户登录
- **账号1：** `mustar` / `123456`
- **账号2：** `123456` / `123456` 
- **预期结果：** 能够正常登录，跳转到用户管理页面
- **错误场景：** 输入错误密码应显示"用户名或密码错误"

### ✅ 测试2：用户注册功能
1. **访问注册页面**
   - 输入用户名：`testuser`（至少3字符）
   - 输入密码：`123456`（至少6字符）
   - 选择角色：`USER` 或 `ADMIN`
   
2. **用户名检查**
   - 输入已存在用户名应提示"用户名已存在"
   - 输入新用户名应显示可用
   
3. **注册提交**
   - **预期结果：** 显示"注册成功！请使用新账号登录"
   - **预期行为：** 自动跳转到登录页面

### ✅ 测试3：注册用户登录
- **使用新注册的账号登录**
- **预期结果：** 能够正常登录

### ✅ 测试4：用户管理界面
1. **登录后访问用户管理页面**
2. **预期显示：**
   - `mustar` (ADMIN)
   - `123456` (ADMIN)  
   - 新注册的用户
3. **数据一致性：** 注册的用户应该出现在用户列表中

### ✅ 测试5：错误处理
1. **后端未启动时：**
   - 登录：显示"无法连接到服务器"
   - 注册：显示"无法连接到服务器" 
   
2. **输入验证：**
   - 用户名少于3字符：提示错误
   - 密码少于6字符：提示错误
   - 空白输入：提示"不能为空"

## 🎯 验证重点

### 关键验证点：
- [ ] **数据库存储：** 注册的用户数据确实保存在 `sys_user` 表中
- [ ] **无localStorage干扰：** 清空浏览器localStorage后功能仍正常
- [ ] **完全依赖后端：** 后端停止后无法登录/注册（符合预期）
- [ ] **错误提示清晰：** 各种错误场景都有明确提示

### 数据库验证查询：
```sql
-- 查看所有用户（包括新注册的）
SELECT id, username, password, role, created_at FROM sys_user ORDER BY id;
```

## 🐛 可能遇到的问题

1. **后端连接失败：** 检查MySQL服务是否运行，数据库是否存在
2. **前端API调用失败：** 检查 request.js 中的 baseURL 配置
3. **密码验证失败：** 确认数据库中mustar用户密码已更新
4. **CORS错误：** 后端已配置CORS，应该不会出现

## 📊 测试结果记录

请在测试完成后记录结果：

- [ ] 现有用户登录：✅ 通过 / ❌ 失败 - 备注：_______
- [ ] 用户注册：✅ 通过 / ❌ 失败 - 备注：_______  
- [ ] 注册用户登录：✅ 通过 / ❌ 失败 - 备注：_______
- [ ] 用户管理数据一致：✅ 通过 / ❌ 失败 - 备注：_______
- [ ] 错误处理：✅ 通过 / ❌ 失败 - 备注：_______

---

**修复完成！现在系统完全依赖MySQL数据库，localStorage仅用于存储登录token。**